<mat-card>
    <mat-card-title style="font-family: 'Times New Roman', Times, serif;font-size:320%;color: #0d17a1;padding: 1%;">
        Fee Report
    </mat-card-title><br><br>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" style="margin-left: 54px;">
        <mat-form-field>
            <mat-label>From Date</mat-label>
            <input matInput [matDatepicker]="fromPicker" formControlName="fromDate">
            <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
            <mat-datepicker #fromPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
            <mat-label>To Date</mat-label>
            <input matInput [matDatepicker]="toPicker" formControlName="toDate">
            <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
            <mat-datepicker #toPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
                <mat-option [value]="null">All</mat-option>
                <mat-option [value]="feeStatus.paid">Paid</mat-option>
                <mat-option [value]="feeStatus.pending">Pending</mat-option>
                <mat-option [value]="feeStatus.partiallyPaid">Partially Paid</mat-option>
            </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit"
            style="margin-left: 20px;margin-bottom: 20px;">Search</button>
    </form>
    <div style="display: flex; gap: 12px; margin-top: 16px; justify-content: center;">
        <mat-card style="max-width: 250px; padding: 12px; background-color: #e3f2fd; color: #0d47a1;">
            <mat-card-title style="font-size: 16px;">Today's Collection</mat-card-title>
            <mat-card-content style="font-size: 14px; line-height: 1.8; padding: 8px 16px;">
                <div style="display: flex; justify-content: space-between; font-weight: 500;">
                    <span>Total &nbsp;</span>
                    <span>:{{ getTodayTotalCollection() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Collected &nbsp;</span>
                    <span>:{{ getTodayCollected() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Balance &nbsp;</span>
                    <span>:{{ getTodayPending() }}</span>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card style="max-width: 250px; padding: 12px; background-color: #f1f8e9; color: #33691e;">
            <mat-card-title style="font-size: 16px;">Current Month</mat-card-title>
            <mat-card-content style="font-size: 14px; line-height: 1.8; padding: 8px 16px;">
                <div style="display: flex; justify-content: space-between; font-weight: 500;">
                    <span>Total &nbsp;</span>
                    <span>:{{ getMonthTotalCollection() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Collected &nbsp;</span>
                    <span>:{{ getMonthCollected() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Balance &nbsp;</span>
                    <span>:{{ getMonthPending() }}</span>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card style="margin-top: 16px; padding: 12px; background-color: #f6e4fa;">
            <mat-card-title style="font-size: 16px;">Legend</mat-card-title>
            <mat-card-content style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 14px;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #c8e6c9; border: 1px solid #81c784;"></div>
                    Paid
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color:  #ccedf5; border: 1px solid #81c784;"></div>
                    Partialy Paid
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #fff9c4; border: 1px solid #fdd835;"></div>
                    Current Month
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #ffcdd2; border: 1px solid #e57373;"></div>
                    Overdue
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #fad2b0; border: 1px solid #f6c564;"></div>
                    Today
                </div>
            </mat-card-content>
        </mat-card>

    </div>
    <div class="mat-elevation-z8">
        <table mat-table [dataSource]="filterFee" class="full-width-table">

            <!-- No. Column -->
            <ng-container matColumnDef="no">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">No.</th>
                <td mat-cell *matCellDef="let item; let i = index">{{ i + 1 }}</td>
            </ng-container>

            <!-- Due Amount Column -->
            <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">Amount
                    (Rs.)</th>
                <td mat-cell *matCellDef="let item">{{ item.amount }}</td>
            </ng-container>

            <!-- Balance -->
            <ng-container matColumnDef="amountRecieved">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">Amount Recieved
                    (Rs.)</th>
                <td mat-cell *matCellDef="let item">{{ item.amountReceived }}</td>
            </ng-container>

            <!-- Due Date Column -->
            <ng-container matColumnDef="dueDate">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">Due Date
                </th>
                <td mat-cell *matCellDef="let item">{{ item.dueDate }}</td>
            </ng-container>

            <ng-container matColumnDef="feeStatus">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">Status</th>
                <td mat-cell *matCellDef="let item">
                    {{ item.status === feeStatus.pending ? 'Pending' :
                    item.status === feeStatus.paid ? 'Paid' :
                    item.status === feeStatus.partiallyPaid ? 'Partially Paid' :
                    'Unknown' }}
                </td>
            </ng-container>

            <!-- Detail Button Column -->
            <ng-container matColumnDef="detail">
                <th mat-header-cell *matHeaderCellDef style="background-color: aliceblue;font-size: larger;">Detail</th>
                <td mat-cell *matCellDef="let item">
                    <button mat-button color="primary" (click)="viewDetails(item)">Detail</button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="getRowClass(row)"></tr>

        </table>
    </div>
</mat-card>